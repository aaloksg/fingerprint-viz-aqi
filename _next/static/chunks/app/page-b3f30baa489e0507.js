(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1824:(e,t,a)=>{Promise.resolve().then(a.bind(a,3479))},3479:(e,t,a)=>{"use strict";a.d(t,{default:()=>L});var i=a(5155);let n={name:"Safe Levels - extended",id:"ExtendedSafeLevels",values:{no2:50,pm25:50,pm10:50,o3:50,co:50,so2:50}};var s=a(2115);class l{constructor(e,t={useCache:!1}){this.isLoading=!1,this.promiseStack=[],this.resolveAll=()=>{this.promiseStack.forEach(e=>e(this.responseCache)),this.promiseStack.splice(0)},this.execute=async()=>{if(this.options.useCache&&this.responseCache)return this.responseCache;if(this.isLoading)return new Promise(e=>{this.promiseStack.push(e)});this.isLoading=!0;let e=await fetch(this.url).then(e=>e.json());if(this.isLoading=!1,"ok"===e.status)return this.responseCache=e.data,this.resolveAll(),e.data;this.resolveAll()},this.url=e,this.options=t}}let r="d577a785bc98d866dd1360f3cbfaa58de9279dc9",o=(()=>{let e=new l("https://api.waqi.info/v2/map/bounds?latlng=".concat(0,",").concat(0,",").concat(90,",").concat(180,"&networks=all&token=").concat(r),{useCache:!0}),t=new l("https://api.waqi.info/feed/here/?token=".concat(r));return{fetchStations:()=>e.execute(),fetchHere:()=>t.execute(),searchStation:e=>new l("https://api.waqi.info/search/?keyword=".concat(e,"&token=").concat(r),{useCache:!0}).execute(),fetchStation:e=>new l("https://api.waqi.info/v2/feed/".concat(e,"/?token=").concat(r),{useCache:!0}).execute(),fetchGeoStation:e=>{let[t,a]=e;return new l("https://api.waqi.info/feed/geo:".concat(t,";").concat(a,"/?token=").concat(r),{useCache:!0}).execute()}}})();var c=a(9327);let u=(0,s.createContext)({activeQuality:"",setActiveQuality:()=>{}}),h=e=>e>300?"#cb0000":e>200?"#8f3f97":e>150?"#ff0000":e>100?"#ff7e00":e>50?"#ffff00":"#00e400",d=e=>{let{side:t,cx:a,cy:n,ry:l,clipPath:r,data:o}=e,c="left"===t,d=h(o.value),{activeQuality:f,setActiveQuality:x}=(0,s.useContext)(u),[m,p]=(0,s.useState)(0),[g,w]=(0,s.useState)(""),[j,y]=(0,s.useState)(1),k=(0,s.useRef)(null),b=(0,s.useCallback)(()=>{let e,t;if(!k.current)return;let a=k.current.getTotalLength()/2;p(a),1===o.ratio?(e="".concat(a,",").concat(a),t=c?-a/2:a/2):(e="".concat(a*o.ratio,",").concat((2-o.ratio)*a),t=c?-a/2:a*o.ratio-a/2),w(e),y(t)},[o.ratio,c]);return(0,s.useLayoutEffect)(()=>{b()}),(0,i.jsxs)("g",{onPointerEnter:()=>x(o.name),onPointerLeave:()=>x(""),onPointerDown:()=>x(o.name),onPointerUp:()=>x(""),children:[(0,i.jsx)("ellipse",{cx:a,cy:n,fill:"none",stroke:d,strokeOpacity:0,strokeWidth:12,rx:.6*l,ry:l,clipPath:r,strokeDasharray:g,strokeDashoffset:j}),(0,i.jsx)("ellipse",{ref:k,cx:a,cy:n,fill:"none",stroke:d,strokeOpacity:f&&f!==o.name?.2:1,strokeWidth:2,rx:.6*l,ry:l,clipPath:r,className:"transition-all duration-500",strokeDasharray:g,strokeDashoffset:2*m,style:{transition:"stroke-dashoffset 1s",strokeDashoffset:j}})]})},f=(0,s.createContext)({height:0,width:0});var x=a(348);let m=e=>{let{x:t,y:a,px:n,py:s,text:l,clipPath:r,textColor:o,bgColor:c,opacity:u,textAnchor:h}=e,{ref:d,height:f,width:m}=(0,x.A)(),p=null!=n?n:4,g=null!=s?s:4,w="end"!==h;return(0,i.jsxs)("g",{children:[f&&m&&(0,i.jsx)("rect",{x:w?t:t-m-2*p,y:a-g-f/2,rx:"5px",height:f+2*g,width:m+2*p,fill:null!=c?c:"none",fillOpacity:null!=u?u:.6,strokeWidth:0,clipPath:r,className:"transition-all"}),(0,i.jsx)("text",{ref:d,x:t,y:a,dx:w?p:-p,alignmentBaseline:"middle",textAnchor:w?"start":"end",fill:o,fillOpacity:null!=u?u:1,clipPath:r,className:"font-light cursor-default text-xs sm:text-sm md:text-base lg:text-lg transition-all",children:l})]})},p=e=>e>300?"#7e0023":e>200?"#8f3f97":e>150?"#ff0000":e>100?"#ff7e00":e>50?"#ffff00":"#00e400",g=e=>{let{side:t,cx:a,cy:n,ry:l,clipPath:r,data:o}=e,c=p(o.value),{activeQuality:h,setActiveQuality:d}=(0,s.useContext)(u),{width:x}=(0,s.useContext)(f),g=x/2,w=n+l;return(0,i.jsxs)("g",{onPointerEnter:()=>d(o.name),onPointerLeave:()=>d(""),onPointerDown:()=>d(o.name),onPointerUp:()=>d(""),children:[(0,i.jsx)("line",{x1:"left"===t?a-g:a,x2:"left"===t?a:a+g,y1:w,y2:w,stroke:c,strokeOpacity:"0",strokeWidth:"12",rx:l/2,ry:l,clipPath:r}),(0,i.jsx)("line",{x1:"left"===t?a-g:a,x2:"left"===t?a:a+g,y1:w,y2:w,stroke:o.name===h?c:"#8b8b8b",strokeOpacity:h&&o.name!==h?.4:1,strokeWidth:"2",strokeDasharray:"5,5",rx:l/2,ry:l,clipPath:r,className:"transition-all duration-500"}),"left"===t&&(0,i.jsx)(m,{x:Math.max(a-g+40,a-.8*g),y:w,opacity:h&&o.name!==h?.4:1,textColor:o.name===h?"black":"white",bgColor:o.name===h?"white":"black",text:o.name,clipPath:r}),(0,i.jsx)(m,{x:"left"===t?a-g:a+g,y:w,opacity:h&&o.name!==h?.4:1,textColor:o.name===h?"black":"white",bgColor:o.name===h?c:"none",text:o.value.toFixed(2).split(".00")[0],clipPath:r,textAnchor:"right"===t?"end":"start"})]})},w=6,j=e=>{let{side:t,data:a}=e,n="left"===t,l=(0,s.useContext)(f),{height:r}=l,o=l.width/2,c="AqiViz-fingerprint-".concat(t),u="url(#".concat(c,")"),h=r/2,x=r/2-10;.6*x>o&&(x=o/.6);let m=a.data.length,p=Math.max((x-w)/m,22);return(0,i.jsxs)("g",{children:[(0,i.jsx)("clipPath",{id:c,children:(0,i.jsx)("rect",{x:n?0:o,y:"0",height:r,width:o})}),null==a?void 0:a.data.map((e,n)=>(0,i.jsx)(g,{data:e,side:t,cx:o,cy:h,ry:x-p*n,clipPath:u},"".concat(a.name,"-").concat(e.name))),null==a?void 0:a.data.map((e,n)=>(0,i.jsx)(d,{data:e,side:t,cx:o,cy:h,ry:x-p*n,clipPath:u},"".concat(a.name,"-").concat(e.name)))]})},y=()=>{let{ref:e,height:t,width:a}=(0,x.A)(),[i,n]=(0,s.useState)(0),[l,r]=(0,s.useState)(0);return(0,s.useEffect)(()=>{n(a||0),r(t||0)},[a,t]),{svgRef:e,height:l,width:i}};var k=a(710);let b=()=>(0,i.jsx)(k.AhV,{"aria-label":"spinning-loader",className:"size-10 animate-spin text-white"}),S=e=>{let{leftAqiData:t,rightAqiData:a}=e,{svgRef:n,width:l,height:r}=y(),[o,c]=(0,s.useState)(""),[h,d]=(()=>{let e={name:t.name,data:[]},i={name:a.name,data:[]},n=Object.keys(a.values);return Object.keys(t.values).filter(e=>n.includes(e)).forEach(n=>{var s,l;let r=null!==(s=t.values[n])&&void 0!==s?s:0,o=null!==(l=a.values[n])&&void 0!==l?l:0;e.data.push({name:n,value:r,ratio:Math.min(1,r/o)}),i.data.push({name:n,value:o,ratio:Math.min(1,o/r)})}),[e,i]})();return(0,i.jsx)(f,{value:{height:r,width:l},children:(0,i.jsx)(u,{value:{activeQuality:o,setActiveQuality:c},children:l&&r&&h&&d?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{ref:n,className:"relative w-full h-full",children:(0,i.jsxs)("svg",{width:"100%",height:"100%",id:"ContainerSVG",children:[(0,i.jsx)("defs",{id:"F1DataVisDefs"}),(0,i.jsx)(j,{side:"left",data:h}),(0,i.jsx)(j,{side:"right",data:d}),(0,i.jsx)("line",{x1:l/2,x2:l/2,y1:0,y2:r,stroke:"white",strokeOpacity:"0.7",strokeWidth:3})]})})}):(0,i.jsx)("div",{ref:n,className:"relative w-full h-full flex justify-center items-center",children:(0,i.jsx)(b,{})})})})},N={region:{read:e=>{if(!e)return;let[t,a,i,n]=e.split("&");return t&&a&&i&&n?{name:t,id:a,geo:[+i,+n]}:void 0},write:e=>"".concat(e.name,"&").concat(e.id).concat(e.geo?"&".concat(e.geo[0],"&").concat(e.geo[1]):"")}};var C=a(9219),A=a(2596),P=a(2515);let q=e=>{let{query:t,placeholder:a,options:n,select:l}=e,r="dropdown-".concat((0,s.useId)()),o=(e,a)=>{l(e),t.value="",a()};return(0,i.jsx)(C.AM,{children:e=>{let{open:s}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:(0,A.A)("relative w-full"),children:[(0,i.jsx)(C.ut,{className:(0,A.A)(s?"invisible":"","relative p-2 pr-8 rounded-lg pointer-events-auto block w-full","text-start text-sm/6 font-semibold outline-2","text-white/40 focus-within:text-white/100 focus:text-white/100   hover:text-white/100 ","outline-white/40 focus-within:outline-white/100 focus:outline-white/100  hover:outline-white/100"),children:a}),s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{className:(0,A.A)("absolute inset-0 left-0 top-0","p-2 pr-8 rounded-lg pointer-events-auto w-full","text-start text-sm/6 font-semibold outline-2","text-white/40 focus-within:text-white/100 focus:text-white/100   hover:text-white/100 ","outline-white/40 focus-within:outline-white/100 focus:outline-white/100  hover:outline-white/100"),autoFocus:!0,type:"text",placeholder:a,value:t.value,onChange:e=>{let{target:a}=e;return t.value=a.value}}),(0,i.jsx)("button",{className:"group absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer",onPointerDownCapture:()=>t.value="",children:(0,i.jsx)(P.Tfw,{className:"size-4 text-white group-hover:opacity-75"})})]})]}),(0,i.jsx)(C.QT,{transition:!0,anchor:{to:"bottom",gap:5},className:"pointer-events-auto transition duration-200 ease-in-out [--anchor-gap:var(--spacing-5)] data-[closed]:-translate-y-1 data-[closed]:opacity-0",children:e=>{let{close:a}=e;return(0,i.jsx)("div",{className:(0,A.A)("p-4 overflow-hidden rounded-xl","[--anchor-gap:var(--spacing-5)] data-[closed]:-translate-y-1 data-[closed]:opacity-0 ","bg-black/80","transition duration-200 ease-in-out"),children:(0,i.jsx)("div",{className:(0,A.A)(" w-80 max-h-80 max-w-full min-h-64 overflow-y-auto","flex flex-row items-center",n.length?"flex-wrap":t.value.length?"justify-center":"invisible pointer-events-none"),children:n.length&&n.map(e=>(0,i.jsx)("button",{onClick:()=>o(e,a),className:"text-start px-4 rounded-lg py-2 text-sm text-gray-300 hover:bg-blue-300/30 active:bg-blue-300/30 data-focus:outline-hidden",children:e.value},"".concat(r,"-option-").concat(e.id)))||t.value.length&&(0,i.jsx)(b,{})})})}})]})}})},D=e=>{let[t,a]=(0,s.useState)(e);return{set value(v){a(v)},get value(){return t}}};var O=a(2064);let E=e=>{let{setLeftRegion:t,setRightRegion:a,leftName:n,rightName:l,children:r}=e,[c,u]=(0,s.useState)([]),[h,d]=(0,s.useState)([]),f=D(""),x=D("");return(0,O.A)(async()=>{if(!f.value){u([]);return}o.searchStation(f.value).then(e=>{if(console.log("Stations found: ".concat(e)),!(null==e?void 0:e.length)){u([]);return}u(e.map(e=>({value:e.station.name,id:e.uid.toString(),data:e})))})},300,[f.value]),(0,O.A)(async()=>{if(!x.value){d([]);return}o.searchStation(x.value).then(e=>{if(!(null==e?void 0:e.length)){d([]);return}d(e.map(e=>({value:e.station.name,id:e.uid.toString(),data:e})))})},300,[x.value]),(0,i.jsxs)("div",{className:"h-full w-full flex flex-col justify-between gap-2 p-4 overflow-hidden",children:[(0,i.jsxs)("div",{className:"w-full flex justify-around gap-4",children:[(0,i.jsx)("div",{className:"grow w-10 max-w-60",children:(0,i.jsx)(q,{query:f,placeholder:"Search for a station...",options:c,select:e=>t(e.data)})}),(0,i.jsx)("div",{className:"grow w-10 max-w-60",children:(0,i.jsx)(q,{query:x,placeholder:"Search for a station...",options:h,select:e=>a(e.data)})})]}),(0,i.jsx)("div",{className:"w-full h-auto grow flex justify-center items-center",children:r}),(0,i.jsxs)("div",{className:"w-full flex items-start text-base sm:text-lg md:text-xl font-extralight text-blue-400",children:[(0,i.jsx)("div",{className:"grow flex justify-center max-w-1/2 text-center ",children:(0,i.jsx)("span",{className:"pr-4 md:pr-6 lg:pr-10 transition ",children:n})}),(0,i.jsx)("div",{className:"grow flex justify-center max-w-1/2 text-center ",children:(0,i.jsx)("span",{className:"pl-4 md:pl-6 lg:pl-10 transition",children:l})})]})]})},L=()=>{let[e,t]=(0,s.useState)({name:"",id:"",values:{}}),[a,l]=(0,s.useState)({name:"",id:"",values:{}}),[r,u]=(0,c.A)("fingerprint-viz-left-region",N.region.write(n)),[h,d]=(0,c.A)("fingerprint-viz-right-region",N.region.write(n)),f=(0,s.useCallback)(a=>{let i=a.uid.toString(),s=a.station.name,l=a.station.geo;if(i!==e.id&&s!==e.name){if(!i||s===n.name){t(n),u(N.region.write(n));return}(async()=>{(l?o.fetchGeoStation(l):o.fetchStation(i)).then(e=>{e&&(t({name:s,id:i,values:Object.keys(e.iaqi).reduce((t,a)=>({...t,[a]:e.iaqi[a].v}),{})}),u(N.region.write({name:s,id:i,geo:l})))})})()}},[u,e]),x=(0,s.useCallback)(e=>{let t=e.uid.toString(),i=e.station.name,s=e.station.geo;if(t!==a.id&&i!==a.name){if(!t||i===n.name){l(n),d(N.region.write(n));return}(async()=>{(s?o.fetchGeoStation(s):o.fetchStation(t)).then(e=>{e&&(l({name:i,id:t,values:Object.keys(e.iaqi).reduce((t,a)=>({...t,[a]:e.iaqi[a].v}),{})}),d(N.region.write({name:i,id:t,geo:s})))})})()}},[d,a]);return(0,s.useEffect)(()=>{if(!e.name){let e=N.region.read(r);f(e?{station:{name:e.name,geo:e.geo},uid:e.id}:{station:{name:n.name},uid:n.id})}if(!a.name){let e=N.region.read(h);x(e?{station:{name:e.name,geo:e.geo},uid:e.id}:{station:{name:n.name},uid:n.id})}}),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E,{leftName:e.name,rightName:a.name,setLeftRegion:f,setRightRegion:x,children:(0,i.jsx)(S,{leftAqiData:e,rightAqiData:a})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[479,603,545,124,441,684,358],()=>t(1824)),_N_E=e.O()}]);